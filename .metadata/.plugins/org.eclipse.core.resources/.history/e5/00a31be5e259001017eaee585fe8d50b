package com.novelsbr.backend.services.impl;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.novelsbr.backend.domain.dto.CommentDTO;
import com.novelsbr.backend.domain.entities.Comment;
import com.novelsbr.backend.domain.entities.CommentChapter;
import com.novelsbr.backend.domain.entities.CommentNovel;
import com.novelsbr.backend.repositories.CommentRepository;
import com.novelsbr.backend.services.AuthorService;
import com.novelsbr.backend.services.ChapterService;
import com.novelsbr.backend.services.CommentService;
import com.novelsbr.backend.services.NovelService;

@Service
public class CommentServiceImpl implements CommentService {

	@Autowired
	private CommentRepository commentRepository;
	
	@Autowired
	private ChapterService chapterService;
	
	@Autowired
	private NovelService novelService;

	@Override
	public void save(CommentDTO commentDTO) {
		Comment commentSaved = preparingCommentToSave(commentDTO);
		commentRepository.save(commentSaved);
	}

	private Comment preparingCommentToSave(CommentDTO commentDTO) {
		Comment comment = new Comment(commentDTO);
		
		if(comment.isNovel()) {
			CommentNovel commentNovel = new CommentNovel(commentDTO);
			commentNovel.setNovel(novelService.findById(commentDTO.getEntityId()));
			return commentNovel;
			
		} else if(comment.isChapter()) {
			CommentChapter commentChapter = new CommentChapter(commentDTO);
			commentChapter.setChapter(chapterService.findById(commentDTO.getEntityId()));
			return commentChapter;
		}
		return null;
	}
}
